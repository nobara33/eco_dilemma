<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ã‚¨ã‚³ãƒã‚¸ãƒ¬ãƒ³ãƒãƒ»ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: #f5f5f5;
      text-align: center;
      padding: 20px;
    }
    h1 {
      font-size: 24px;
      margin-bottom: 10px;
    }
    .stats {
      margin-bottom: 20px;
    }
    .stats div {
      margin: 5px 0;
    }
    button {
      margin: 6px;
      padding: 10px;
      font-size: 16px;
      width: 300px;
    }
    .log {
      margin-top: 20px;
      font-size: 14px;
      background: #fff;
      padding: 12px;
      border-radius: 8px;
      max-height: 220px;
      overflow-y: auto;
      text-align: left;
    }
    .note {
      font-size: 12px;
      color: #666;
      margin-top: -10px;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <h1>ã‚¨ã‚³ãƒã‚¸ãƒ¬ãƒ³ãƒãƒ»ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h1>
  <div class="stats" id="stats"></div>
  <div class="note">â€»ã‚¿ãƒ¼ãƒ³çµ‚äº†æ™‚ã«æ”¿ç­–äºˆç®—ã¯ +10 å›å¾©ã—ã¾ã™</div>
  <div id="choices"></div>
  <div class="log" id="log"><strong>é¸æŠãƒ­ã‚°:</strong><br></div>
  <script>
    const state = {
      turn: 1,
      maxTurn: 10,
      economy: 50,
      environment: 50,
      happiness: 50,
      budget: 100,
      pendingEffects: [],
      log: [],
      doNothingCount: 0
    };

    function getEmojiBar(value, emoji, reverse = false) {
      const level = Math.floor(Math.min(Math.max(value, 0), 100) / 20);
      const count = reverse ? 5 - level : level;
      return emoji.repeat(Math.max(1, count));
    }

    function getHappinessIcon() {
      const h = state.happiness;
      if (h >= 80) return "ğŸ˜Š";
      if (h >= 60) return "ğŸ˜€";
      if (h >= 40) return "ğŸ˜";
      if (h >= 20) return "ğŸ˜Ÿ";
      return "ğŸ˜«";
    }

    function getEconomyIcon() {
      return state.economy >= 60 ? "ğŸ“ˆ" : "ğŸ“‰";
    }

    const policies = [
      {
        name: "åŸç™ºå†ç¨¼åƒ",
        immediate: () => {
          state.economy += 10;
          state.environment += 5;
          state.happiness -= 5;
          state.budget -= 20;
          log("åŸç™ºã‚’å†ç¨¼åƒã—ã€çµŒæ¸ˆã‚’æ´»æ€§åŒ–ã—ãŸãŒç’°å¢ƒè² è·ãŒå¢—åŠ ã€‚ï¼ˆçµŒæ¸ˆ+10ã€ç’°å¢ƒ+5ã€å¹¸ç¦åº¦-5ã€äºˆç®—-20ï¼‰");
        }
      },
      {
        name: "å†ç”Ÿå¯èƒ½ã‚¨ãƒãƒ«ã‚®ãƒ¼æ¨é€²",
        immediate: () => {
          state.happiness += 5;
          state.budget -= 30;
          scheduleEffect(3, () => {
            state.environment -= 10;
            state.economy += 5;
            log("å†ã‚¨ãƒæ”¿ç­–ãŒå®Ÿã‚’çµã³ã€ç’°å¢ƒæ”¹å–„ã¨çµŒæ¸ˆæˆé•·ãŒå®Ÿç¾ã€‚ï¼ˆç’°å¢ƒ-10ã€çµŒæ¸ˆ+5ï¼‰");
          });
          log("å†ç”Ÿå¯èƒ½ã‚¨ãƒãƒ«ã‚®ãƒ¼æ¨é€²ã«æŠ•è³‡ã—ãŸã€‚ï¼ˆå¹¸ç¦åº¦+5ã€äºˆç®—-30ï¼‰");
        }
      },
      {
        name: "EVè£œåŠ©é‡‘",
        immediate: () => {
          state.happiness += 7;
          state.budget -= 25;
          scheduleEffect(4, () => {
            state.environment -= 8;
            state.economy += 3;
            log("EVæ™®åŠãŒé€²ã¿ã€ç’°å¢ƒè² è·ãŒè»½æ¸›ã•ã‚ŒçµŒæ¸ˆã‚‚åˆºæ¿€ã•ã‚ŒãŸã€‚ï¼ˆç’°å¢ƒ-8ã€çµŒæ¸ˆ+3ï¼‰");
          });
          log("EVè£œåŠ©é‡‘ã‚’æ”¯çµ¦ã—ãŸã€‚ï¼ˆå¹¸ç¦åº¦+7ã€äºˆç®—-25ï¼‰");
        }
      },
      {
        name: "ç’°å¢ƒè¦åˆ¶ã®å¼·åŒ–",
        immediate: () => {
          state.economy -= 10;
          state.budget -= 10;
          scheduleEffect(3, () => {
            state.environment -= 5;
            state.happiness += 5;
            log("ç’°å¢ƒè¦åˆ¶ã®åŠ¹æœã§ç©ºæ°—ãŒæ”¹å–„ã—å¹¸ç¦åº¦ãŒä¸Šæ˜‡ã—ãŸã€‚ï¼ˆç’°å¢ƒ-5ã€å¹¸ç¦åº¦+5ï¼‰");
          });
          log("ç’°å¢ƒè¦åˆ¶ã‚’å¼·åŒ–ã—ãŸã€‚ï¼ˆçµŒæ¸ˆ-10ã€äºˆç®—-10ï¼‰");
        }
      },
      {
        name: "æ‰€å¾—ç¨æ¸›ç¨",
        immediate: () => {
          state.economy += 5;
          state.happiness += 5;
          state.budget -= 20;
          scheduleEffect(2, () => {
            state.budget -= 10;
            log("æ’ä¹…çš„ãªç¨åæ¸›ã«ã‚ˆã‚Šè²¡æ”¿ä½™åŠ›ãŒæ¸›ã£ãŸã€‚ï¼ˆäºˆç®—-10ï¼‰");
          });
          log("æ‰€å¾—ç¨ã‚’æ¸›ç¨ã—ãŸã€‚ï¼ˆçµŒæ¸ˆ+5ã€å¹¸ç¦åº¦+5ã€äºˆç®—-20ï¼‰");
        }
      },
      {
        name: "çŸ³ç‚­ç«åŠ›ç™ºé›»ã®æ‹¡å¤§",
        immediate: () => {
          state.economy += 10;
          state.environment += 10;
          state.budget -= 10;
          scheduleEffect(2, () => {
            state.happiness -= 5;
            log("çŸ³ç‚­ç«åŠ›ã®å½±éŸ¿ã§ç©ºæ°—ãŒæ‚ªåŒ–ã—å¹¸ç¦åº¦ãŒä½ä¸‹ã—ãŸã€‚ï¼ˆå¹¸ç¦åº¦-5ï¼‰");
          });
          log("çŸ³ç‚­ç«åŠ›ç™ºé›»æ‰€ã‚’æ‹¡å¤§ã—ãŸã€‚ï¼ˆçµŒæ¸ˆ+10ã€ç’°å¢ƒ+10ã€äºˆç®—-10ï¼‰");
        }
      },
      {
        name: "ãªã«ã‚‚ã—ãªã„",
        immediate: () => {
          state.doNothingCount++;
          scheduleEffect(2, () => {
            state.environment += 10;
            state.happiness -= 5;
            log("ä½•ã‚‚ã—ãªã‹ã£ãŸã“ã¨ã§ç’°å¢ƒãŒæ‚ªåŒ–ã—å›½æ°‘ã®ä¸æº€ãŒé«˜ã¾ã£ãŸã€‚ï¼ˆç’°å¢ƒ+10ã€å¹¸ç¦åº¦-5ï¼‰");
          });
          log("ç‰¹ã«æ”¿ç­–ã‚’å®Ÿæ–½ã—ãªã‹ã£ãŸã€‚");
        }
      }
    ];

    function scheduleEffect(delay, effect) {
      state.pendingEffects.push({ turn: state.turn + delay, effect });
    }

    function applyPendingEffects() {
      const due = state.pendingEffects.filter(e => e.turn === state.turn);
      due.forEach(e => e.effect());
      state.pendingEffects = state.pendingEffects.filter(e => e.turn > state.turn);
    }

    function log(text) {
      state.log.push(text);
      const logDiv = document.getElementById("log");
      logDiv.innerHTML = "<strong>é¸æŠãƒ­ã‚°:</strong><br>" + state.log.map(l => "ãƒ»" + l).join("<br>");
    }

    function updateStats() {
      const s = state;
      document.getElementById("stats").innerHTML = `
        <div><strong>ã‚¿ãƒ¼ãƒ³:</strong> ${s.turn} / ${s.maxTurn}</div>
        <div><strong>çµŒæ¸ˆæ´»æ€§åº¦:</strong> ${s.economy} ${getEconomyIcon()}</div>
        <div><strong>ç’°å¢ƒè² è·ãƒ¬ãƒ™ãƒ«:</strong> ${s.environment} ${getEmojiBar(s.environment, "ğŸŒ±", true)}</div>
        <div><strong>å¹¸ç¦åº¦:</strong> ${s.happiness} ${getHappinessIcon()}</div>
        <div><strong>æ”¿ç­–äºˆç®—:</strong> ${s.budget} ${getEmojiBar(s.budget, "ğŸ’°")}</div>
      `;
    }

    function getResultComment() {
      const { economy, environment, happiness, doNothingCount, maxTurn } = state;
      if (doNothingCount === maxTurn) {
        return { type: "ğŸ¤” ç„¡ç­–å‹", comment: "ã™ã¹ã¦ã®ã‚¿ãƒ¼ãƒ³ã§ä½•ã‚‚ã›ãšã€çŠ¶æ³ã¯æ‚ªåŒ–ã—ã¾ã—ãŸã€‚é¸æŠã—ãªã„ã“ã¨ã‚‚ã¾ãŸé¸æŠã§ã™ãŒã€ãã®ä»£å„Ÿã¯å°ã•ããªã‹ã£ãŸã‚ˆã†ã§ã™ã€‚" };
      }
      if (economy >= 70 && environment <= 20 && happiness >= 80) {
        return { type: "ğŸ† å„ªç­‰ç”Ÿå‹", comment: "çµŒæ¸ˆãƒ»ç’°å¢ƒãƒ»å¹¸ç¦åº¦ã®ã™ã¹ã¦ã«ãŠã„ã¦ç´ æ™´ã‚‰ã—ã„æˆæœã‚’åã‚ã¾ã—ãŸã€‚æ¨¡ç¯„çš„ãªæ”¿ç­–åˆ¤æ–­ã§ã—ãŸã€‚" };
      }
      if (economy >= 70 && environment >= 50) {
        return { type: "ğŸ™ï¸ çµŒæ¸ˆå„ªå…ˆå‹", comment: "ã‚ãªãŸã¯çµŒæ¸ˆã‚’å¤§ããæˆé•·ã•ã›ã‚‹é“ã‚’é¸ã³ã¾ã—ãŸã€‚ç’°å¢ƒã¸ã®è² è·ã¯ã‚„ã‚„å¢—ãˆã¾ã—ãŸãŒã€æ´»ç™ºãªç”£æ¥­æ´»å‹•ã«ã‚ˆã£ã¦å¤šãã®äººãŒè±Šã‹ã•ã‚’æ„Ÿã˜ãŸã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚" };
      } else if (environment <= 40 && economy <= 60) {
        return { type: "ğŸŒ± ç’°å¢ƒä¿è­·å‹", comment: "ã‚ãªãŸã¯ç’°å¢ƒã¸ã®é…æ…®ã‚’é‡è¦–ã—ã¾ã—ãŸã€‚çµŒæ¸ˆã®æˆé•·ã¯æ§ãˆã‚ã§ã—ãŸãŒã€æœªæ¥ã®ä¸–ä»£ã®ãŸã‚ã«ç¾ã—ã„åœ°çƒã‚’æ®‹ãã†ã¨ã™ã‚‹å§¿å‹¢ãŒè¦‹ã‚‰ã‚Œã¾ã—ãŸã€‚" };
      } else if (
        economy >= 50 && economy <= 85 &&
        environment >= 40 && environment <= 80 &&
        happiness >= 50 && happiness <= 85
      ) {
        return { type: "âš–ï¸ ãƒãƒ©ãƒ³ã‚¹å‹", comment: "ã‚ãªãŸã¯é›£ã—ã„ã‚¸ãƒ¬ãƒ³ãƒã®ä¸­ã§ãƒãƒ©ãƒ³ã‚¹ã‚’å–ã‚Šç¶šã‘ã¾ã—ãŸã€‚ã™ã¹ã¦ã‚’å®Œç’§ã«ã™ã‚‹ã®ã¯é›£ã—ãã¦ã‚‚ã€å¤šãã®äººã«ã¨ã£ã¦ç´å¾—æ„Ÿã®ã‚ã‚‹ç¤¾ä¼šã‚’ç›®æŒ‡ã—ãŸã¨ã„ãˆã‚‹ã§ã—ã‚‡ã†ã€‚" };
      } else {
        return { type: "ğŸŒ€ ãã®ä»–", comment: "ã‚ãªãŸã®é¸ã‚“ã é“ã«ã¯ç‹¬è‡ªã®ãƒãƒ©ãƒ³ã‚¹ãŒã‚ã‚Šã¾ã—ãŸã€‚æ¬¡ã«ä½•ã‚’é¸ã¶ã‹ãŒã€ã‚ˆã‚Šã‚ˆã„æœªæ¥ã¸ã®ãƒ’ãƒ³ãƒˆã«ãªã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚" };
      }
    }

    function nextTurn() {
      if(state.turn > state.maxTurn) return;
      applyPendingEffects();
      updateStats();
      const choiceDiv = document.getElementById("choices");
      choiceDiv.innerHTML = "<h3>æ”¿ç­–ã‚’é¸ã‚“ã§ãã ã•ã„ï¼š</h3>";
      policies.forEach(p => {
        const btn = document.createElement("button");
        btn.textContent = p.name;
        if (state.budget < 0 && p.name !== "ãªã«ã‚‚ã—ãªã„") {
          btn.disabled = true;
        }
        btn.onclick = () => {
          p.immediate();
          updateStats();
          state.turn++;
          state.budget += 10;
          log("æ”¿ç­–äºˆç®—ãŒ10å›å¾©ã—ãŸã€‚ï¼ˆ+10ï¼‰");
          if(state.turn > state.maxTurn){
            endGame();
          } else {
            nextTurn();
          }
        };
        choiceDiv.appendChild(btn);
      });
    }

    function endGame() {
      const s = state;
      const result = getResultComment();
      document.getElementById("choices").innerHTML = `
        <h2>ã‚²ãƒ¼ãƒ çµ‚äº†</h2>
        <p>æœ€çµ‚çµæœï¼š</p>
        <ul style="text-align:left; display:inline-block;">
          <li>çµŒæ¸ˆæ´»æ€§åº¦ï¼š${s.economy} ${getEconomyIcon()}</li>
          <li>ç’°å¢ƒè² è·ãƒ¬ãƒ™ãƒ«ï¼š${s.environment} ${getEmojiBar(s.environment, "ğŸŒ±", true)}</li>
          <li>å¹¸ç¦åº¦ï¼š${s.happiness} ${getHappinessIcon()}</li>
          <li>æ”¿ç­–äºˆç®—ï¼š${s.budget} ${getEmojiBar(s.budget, "ğŸ’°")}</li>
        </ul>
        <h3>${result.type}</h3>
        <p>${result.comment}</p>
        <p><strong>ã‚¸ãƒ¬ãƒ³ãƒã®ä¸­ã§ã©ã†ãƒãƒ©ãƒ³ã‚¹ã‚’ã¨ã£ãŸã‹ã‚’æŒ¯ã‚Šè¿”ã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</strong></p>
      `;
    }

    nextTurn();
  </script>
  <p><a href="https://nobara33.github.io/">â† ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹</a></p>
</body>
</html>
